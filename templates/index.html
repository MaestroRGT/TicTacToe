<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TicTacToe</title>

  <!-- favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Crect rx='28' width='128' height='128' fill='%230b1220'/%3E%3Ctext x='50%25' y='56%25' text-anchor='middle' font-size='34' font-family='Arial' fill='%23ffffff'%3ETwitter%3C/text%3E%3C/svg%3E">

  <style>
    :root{
      --bg1:#0f172a;
      --bg2:#111827;
      --card: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --stroke: rgba(255,255,255,.18);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 22px;
      --gap: 12px;
      --cell: 104px;
    }
    *{ box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 20px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(99,102,241,.35), transparent 55%),
        radial-gradient(900px 500px at 90% 20%, rgba(34,197,94,.22), transparent 55%),
        radial-gradient(1000px 700px at 50% 100%, rgba(236,72,153,.18), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
    }

    /* ‚úÖ Layout: jeu s√©par√© du texte + texte plus large */
    .page{
      width: min(980px, 100%);
      display:grid;
      grid-template-columns: 420px 1fr;
      gap: 18px;
      align-items:start;
    }
    @media (max-width: 900px){
      .page{ grid-template-columns: 1fr; }
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.05));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .top{
      padding: 18px 18px 12px;
      display:flex;
      gap: 14px;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .brand h1{ font-size: 18px; margin:0; }
    .brand .sub{ font-size: 12px; color: var(--muted); margin-top:2px; }

    .badge{
      font-size:12px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      color: var(--text);
      display:flex;
      align-items:center;
      gap: 8px;
      user-select:none;
      white-space: nowrap;
    }
    .dot{
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(34,197,94,.95);
      box-shadow: 0 0 0 4px rgba(34,197,94,.16);
    }

    .content{ padding: 16px 18px 18px; }

    #status{
      min-height: 28px;
      font-size: 15px;
      color: var(--muted);
      margin-bottom: 14px;
    }
    #status b{ color: var(--text); }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap);
      padding: 12px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
    }

    button.cell{
      height: var(--cell);
      width: 100%;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      font-size: 54px;
      cursor: pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      display:flex; align-items:center; justify-content:center;
      user-select:none;
    }
    button.cell:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.26);
      background: rgba(255,255,255,.12);
    }
    button.cell:disabled{
      opacity: .65;
      cursor:not-allowed;
      transform:none;
    }

    .actions{
      display:flex;
      gap: 10px;
      margin-top: 14px;
    }
    .btn{
      flex:1;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: var(--text);
      cursor:pointer;
      font-weight: 800;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.26);
    }
    .btn.primary{
      background: linear-gradient(90deg, rgba(99,102,241,.85), rgba(236,72,153,.75));
      border-color: rgba(255,255,255,.22);
    }

    /* ‚úÖ Overlays */
    .overlayBack{
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.62);
      z-index: 9999;
      opacity: 1;
      transition: opacity .18s ease;
    }
    .overlayBack.hide{
      opacity: 0;
      pointer-events: none;
    }
    .overlayCard{
      width: min(520px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(15, 23, 42, .80);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      padding: 18px;
      transform: scale(1);
      transition: transform .18s ease, opacity .18s ease;
      text-align:center;
    }
    .overlayBack.hide .overlayCard{ transform: scale(.96); }

    .heroTitle{
      font-size: 40px;
      margin: 8px 0 6px;
      letter-spacing: .6px;
      font-weight: 900;
    }
    .heroSub{
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 13px;
    }
    .logoRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      margin: 8px 0 18px;
    }
    .logoBox{
      width: 86px; height: 64px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:center;
      font-size: 44px;
      font-weight: 900;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
    }
    .bigBtn{
      width: 100%;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(90deg, rgba(34,197,94,.88), rgba(99,102,241,.85));
      color: #0b1220;
      font-weight: 900;
      font-size: 16px;
      cursor:pointer;
      transition: transform .08s ease;
    }
    .bigBtn:hover{ transform: translateY(-1px); }

    .modeRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 420px){
      .modeRow{ grid-template-columns: 1fr; }
    }

    .levels{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 420px){
      .levels{ grid-template-columns: 1fr; }
      :root{ --cell: 96px; }
    }
    .levelBtn{
      padding: 12px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      cursor:pointer;
      font-weight: 900;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      text-align:center;
    }
    .levelBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.28);
    }
    .levelHint{
      display:block;
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
      font-weight: 700;
    }

    /* ‚úÖ Text panel (wider) */
    .textPanel{ padding: 18px; }
    .textPanel h2{ margin: 0 0 10px; font-size: 18px; }
    .textPanel h3{ margin: 16px 0 8px; font-size: 15px; }
    .textPanel p, .textPanel li{
      color: var(--muted);
      line-height: 1.65;
      font-size: 14px;
    }
    .textPanel ul{ margin: 8px 0 0; padding-left: 18px; }
    details{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 10px 12px;
    }
    summary{
      cursor: pointer;
      font-weight: 900;
      font-size: 14px;
      color: var(--text);
    }
  </style>
</head>

<body>

  <!-- PLAY overlay -->
  <div class="overlayBack" id="startOverlay">
    <div class="overlayCard">
      <div style="display:inline-block;font-size:12px;font-weight:900;letter-spacing:.8px;
                  padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.10);
                  border:1px solid rgba(255,255,255,.16);">PLAY</div>

      <div class="heroTitle">TIC TAC TOE</div>
      <p class="heroSub">Choisis un mode de jeu</p>

      <div class="logoRow" aria-hidden="true">
        <div class="logoBox">X</div>
        <div class="logoBox">O</div>
        <div class="logoBox">X</div>
      </div>

      <div class="modeRow">
        <button class="bigBtn" id="playAI">‚ñ∂ Play vs AI</button>
        <button class="bigBtn" id="playLocal">üë• 2 Players (Local)</button>
      </div>
    </div>
  </div>

  <!-- Difficulty overlay (only for AI mode) -->
  <div class="overlayBack hide" id="difficultyOverlay" aria-hidden="true">
    <div class="overlayCard">
      <div style="font-size:18px;font-weight:900;margin-bottom:6px;">Choisis ton niveau</div>
      <div style="color:var(--muted);font-size:13px;">Tu joues <b>X</b>. (IA = O)</div>

      <div class="levels">
        <button class="levelBtn" data-level="easy">Facile<span class="levelHint">IA au hasard</span></button>
        <button class="levelBtn" data-level="medium">Moyen<span class="levelHint">Gagne / bloque</span></button>
        <button class="levelBtn" data-level="hard">Difficile<span class="levelHint">Fort mais imparfait</span></button>
      </div>
    </div>
  </div>

  <div class="page">

    <!-- Game card -->
    <div class="card" id="gameCard">
      <div class="top">
        <div class="brand">
          <h1>TicTacToe</h1>
          <div class="sub" id="subline">Choisis un mode</div>
        </div>
        <div class="badge">
          <span class="dot"></span>
          <span id="badgeText">En attente‚Ä¶</span>
        </div>
      </div>

      <div class="content">
        <div id="status"></div>
        <div class="grid" id="grid"></div>

        <div class="actions">
          <button class="btn primary" id="reset">Recommencer</button>
          <button class="btn" id="changeMode">Changer mode</button>
        </div>
      </div>
    </div>

    <!-- Text card (separate) -->
    <div class="card">
      <div class="textPanel">
        <h2>Tic Tac Toe Online</h2>

        <p>
          Tic Tac Toe is a timeless two-player strategy game that‚Äôs easy to learn but great for building logical thinking and planning skills.
          In some regions it‚Äôs also called <b>Noughts and Crosses</b>. Each round pushes you to spot patterns, anticipate moves, and make smart decisions.
        </p>

        <p>
          Beyond being fun, Tic Tac Toe is a quick mental workout: it strengthens problem-solving, attention, and cognitive flexibility.
          Whether you play casually or competitively, it‚Äôs a simple way to train your brain.
        </p>

        <h3>Game Tips</h3>
        <ul>
          <li><b>Start with a corner</b>: corners give more chances to create winning lines.</li>
          <li><b>Control the center</b>: the center offers the most winning paths.</li>
          <li><b>Create a double threat</b>: set up two possible wins to force a mistake.</li>
        </ul>

        <h3>How to Play</h3>
        <ul>
          <li>Select a mode: <b>Play vs AI</b> or <b>2 Players</b>.</li>
          <li>Tap an empty square to place your symbol.</li>
          <li>First to get 3 in a row wins.</li>
          <li>If the board is full with no winner: draw.</li>
        </ul>

        <details>
          <summary>FAQ</summary>
          <p><b>Can Tic Tac Toe end in a draw?</b> Yes. If the grid is full and no one has three in a row, it‚Äôs a draw.</p>
          <p><b>What is the best first move?</b> Center or corner is usually best.</p>
          <p><b>Is Tic Tac Toe solved?</b> Yes. With perfect play from both sides, it ends in a draw.</p>
        </details>

        <p style="margin-top:12px; font-size:12px; color: var(--muted);">
          Last updated: Saturday, January 17, 2026
        </p>
      </div>
    </div>

  </div>

<script>
  // --- state ---
  let board = Array(9).fill("");
  let gameOver = false;

  // mode: "ai" or "local"
  let mode = null;

  // AI difficulty
  let difficulty = null;

  // local turn
  let localTurn = "X";

  // UI
  const grid = document.getElementById("grid");
  const statusEl = document.getElementById("status");
  const badgeText = document.getElementById("badgeText");
  const subline = document.getElementById("subline");

  const startOverlay = document.getElementById("startOverlay");
  const difficultyOverlay = document.getElementById("difficultyOverlay");

  const playAI = document.getElementById("playAI");
  const playLocal = document.getElementById("playLocal");

  const resetBtn = document.getElementById("reset");
  const changeModeBtn = document.getElementById("changeMode");

  const levelButtons = difficultyOverlay.querySelectorAll("button[data-level]");

  function setStatus(html){ statusEl.innerHTML = html; }
  function hide(el){ el.classList.add("hide"); el.setAttribute("aria-hidden","true"); }
  function show(el){ el.classList.remove("hide"); el.setAttribute("aria-hidden","false"); }

  function difficultyLabel(d){
    if (d==="easy") return "Facile";
    if (d==="medium") return "Moyen";
    if (d==="hard") return "Difficile";
    return "";
  }

  function modeLabel(m){
    if (m==="ai") return "Play vs AI";
    if (m==="local") return "2 Players (Local)";
    return "";
  }

  function render(){
    grid.innerHTML = "";
    for(let i=0;i<9;i++){
      const btn = document.createElement("button");
      btn.className = "cell";
      btn.textContent = board[i];
      btn.disabled = gameOver || board[i] !== "" || !mode || (mode==="ai" && !difficulty);
      btn.addEventListener("click", ()=>onClick(i));
      grid.appendChild(btn);
    }
  }

  function resetBoard(keepMode=true){
    board = Array(9).fill("");
    gameOver = false;
    localTurn = "X";
    render();

    if(!keepMode){
      mode = null;
      difficulty = null;
      badgeText.textContent = "En attente‚Ä¶";
      subline.textContent = "Choisis un mode";
      setStatus("");
      show(startOverlay);
      return;
    }

    if(mode==="local"){
      badgeText.textContent = "Mode: 2 Players";
      subline.textContent = "Tour: X";
      setStatus(`Mode <b>2 Players</b> ‚Äî Tour: <b>${localTurn}</b>`);
    } else {
      badgeText.textContent = `AI: ${difficultyLabel(difficulty)}`;
      subline.textContent = `Mode: AI (${difficultyLabel(difficulty)})`;
      setStatus(`Niveau: <b>${difficultyLabel(difficulty)}</b> ‚Äî √Ä toi : <b>X</b> (IA = O)`);
    }
  }

  async function onClick(i){
    if(gameOver) return;

    // LOCAL MODE: no server AI, but we still validate move via /move for winner check consistency
    if(mode === "local"){
      try{
        const resp = await fetch("/move", {
          method:"POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ board, index: i, mode:"local", turn: localTurn })
        });
        const data = await resp.json();
        if(!resp.ok){ setStatus(`Erreur: ${data.error || "probl√®me"}`); return; }

        board = data.board;
        const w = data.winner;

        if(w === "X" || w === "O"){
          gameOver = true;
          setStatus(`üèÜ <b>${w}</b> gagne !`);
        } else if(w === "DRAW"){
          gameOver = true;
          setStatus(`ü§ù Match nul !`);
        } else {
          // next turn
          localTurn = (localTurn === "X") ? "O" : "X";
          subline.textContent = `Tour: ${localTurn}`;
          setStatus(`Mode <b>2 Players</b> ‚Äî Tour: <b>${localTurn}</b>`);
        }
        render();
      } catch(e){
        setStatus("Erreur r√©seau/serveur.");
      }
      return;
    }

    // AI MODE
    if(mode === "ai" && !difficulty){
      show(difficultyOverlay);
      return;
    }

    try{
      setStatus(`Niveau: <b>${difficultyLabel(difficulty)}</b> ‚Äî Coup en cours‚Ä¶`);
      const resp = await fetch("/move", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ board, index: i, mode:"ai", difficulty })
      });
      const data = await resp.json();
      if(!resp.ok){ setStatus(`Erreur: ${data.error || "probl√®me serveur"}`); return; }

      board = data.board;
      const w = data.winner;

      if (w === "X"){ gameOver = true; setStatus(`‚úÖ Tu as gagn√© ! (AI <b>${difficultyLabel(difficulty)}</b>)`); }
      else if (w === "O"){ gameOver = true; setStatus(`üòà L‚ÄôIA a gagn√© ! (AI <b>${difficultyLabel(difficulty)}</b>)`); }
      else if (w === "DRAW"){ gameOver = true; setStatus(`ü§ù Match nul ! (AI <b>${difficultyLabel(difficulty)}</b>)`); }
      else { setStatus(`Niveau: <b>${difficultyLabel(difficulty)}</b> ‚Äî √Ä toi : <b>X</b> (IA = O)`); }

      render();
    } catch(e){
      setStatus("Erreur r√©seau/serveur.");
    }
  }

  // --- Flow ---
  playAI.addEventListener("click", ()=>{
    mode = "ai";
    hide(startOverlay);
    show(difficultyOverlay); // ask level now
    badgeText.textContent = "AI: choisir niveau";
    subline.textContent = "Choisis le niveau AI";
    setStatus("");
    render();
  });

  playLocal.addEventListener("click", ()=>{
    mode = "local";
    difficulty = null;
    hide(startOverlay);
    hide(difficultyOverlay);
    resetBoard(true);
  });

  levelButtons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      difficulty = btn.dataset.level;
      hide(difficultyOverlay);
      resetBoard(true);
    });
  });

  resetBtn.addEventListener("click", ()=>resetBoard(true));
  changeModeBtn.addEventListener("click", ()=>resetBoard(false));

  // Init
  show(startOverlay);
  hide(difficultyOverlay);
  render();
</script>

</body>
</html>
