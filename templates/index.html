<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic-Tac-Toe (3 niveaux)</title>

  <style>
    :root{
      --bg1:#0f172a;
      --bg2:#111827;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --stroke: rgba(255,255,255,.18);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 22px;
      --gap: 12px;
      --cell: 112px;
    }

    * { box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 26px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(99,102,241,.35), transparent 55%),
        radial-gradient(900px 500px at 90% 20%, rgba(34,197,94,.22), transparent 55%),
        radial-gradient(1000px 700px at 50% 100%, rgba(236,72,153,.18), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
    }

    .app{
      width: min(420px, 100%);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.05));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .top{
      padding: 18px 18px 12px;
      display:flex;
      gap: 14px;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .brand h1{
      font-size: 18px;
      margin:0;
      letter-spacing:.2px;
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
    }

    .badge{
      font-size:12px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      color: var(--text);
      display:flex;
      align-items:center;
      gap: 8px;
      user-select:none;
    }
    .dot{
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(34,197,94,.95);
      box-shadow: 0 0 0 4px rgba(34,197,94,.16);
    }

    .content{
      padding: 16px 18px 18px;
    }

    #status{
      min-height: 28px;
      font-size: 15px;
      color: var(--muted);
      margin-bottom: 14px;
    }
    #status b{ color: var(--text); }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap);
      padding: 12px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
    }

    button.cell{
      height: var(--cell);
      width: 100%;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: var(--text);
      font-size: 54px;
      cursor: pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }
    button.cell:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.26);
      background: linear-gradient(180deg, rgba(255,255,255,.15), rgba(255,255,255,.07));
    }
    button.cell:active{ transform: translateY(0px) scale(.99); }
    button.cell:disabled{
      opacity: .65;
      cursor:not-allowed;
      transform:none;
    }

    .actions{
      display:flex;
      gap: 10px;
      margin-top: 14px;
    }

    .btn{
      flex:1;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: var(--text);
      cursor:pointer;
      font-weight: 700;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.26);
    }
    .btn.primary{
      background: linear-gradient(90deg, rgba(99,102,241,.85), rgba(236,72,153,.75));
      border-color: rgba(255,255,255,.22);
    }
    .btn.primary:hover{
      background: linear-gradient(90deg, rgba(99,102,241,.95), rgba(236,72,153,.85));
    }

    /* Modal */
    .modalBack{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }
    .modal{
      width: min(520px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(15, 23, 42, .72);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding: 16px;
      color: var(--text);
    }
    .modalHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .modal h2{ margin:0; font-size: 18px; }
    .modal p{ margin: 4px 0 0; color: var(--muted); font-size: 13px; }
    .levels{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .levelBtn{
      padding: 12px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      cursor:pointer;
      font-weight: 800;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .levelBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.28);
    }
    .levelHint{
      display:block;
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 420px){
      :root{ --cell: 96px; }
      .levels{ grid-template-columns: 1fr; }
      .top{ padding: 16px; }
      .content{ padding: 14px 16px 16px; }
    }
  </style>
</head>

<body>

  <!-- Choix niveau -->
  <div class="modalBack" id="difficultyModal">
    <div class="modal">
      <div class="modalHead">
        <div>
          <h2>Choisis ton niveau</h2>
          <p>Tu joues <b>X</b>. L‚ÄôIA joue <b>O</b>. Ensuite la partie continue jusqu‚Äôau gagnant.</p>
        </div>
      </div>

      <div class="levels">
        <button class="levelBtn" data-level="easy">
          Facile
          <span class="levelHint">IA au hasard</span>
        </button>
        <button class="levelBtn" data-level="medium">
          Moyen
          <span class="levelHint">Gagne / bloque</span>
        </button>
        <button class="levelBtn" data-level="hard">
          Difficile
          <span class="levelHint">Minimax (imbattable)</span>
        </button>
      </div>
    </div>
  </div>

  <div class="app">
    <div class="top">
      <div class="brand">
        <h1>Tic-Tac-Toe</h1>
        <div class="sub">3 niveaux ‚Ä¢ Flask + Render</div>
      </div>
      <div class="badge" id="badge">
        <span class="dot"></span>
        <span id="badgeText">Choisis un niveau</span>
      </div>
    </div>

    <div class="content">
      <div id="status"></div>
      <div class="grid" id="grid"></div>

      <div class="actions">
        <button class="btn primary" id="reset">Recommencer</button>
        <button class="btn" id="changeLevel">Changer niveau</button>
      </div>
    </div>
  </div>

<script>
  let board = Array(9).fill("");
  let gameOver = false;
  let difficulty = null;

  const grid = document.getElementById("grid");
  const statusEl = document.getElementById("status");
  const resetBtn = document.getElementById("reset");
  const changeLevelBtn = document.getElementById("changeLevel");

  const modal = document.getElementById("difficultyModal");
  const levelButtons = modal.querySelectorAll("button[data-level]");

  const badgeText = document.getElementById("badgeText");

  function setStatus(html){ statusEl.innerHTML = html; }

  function showModal(show) {
    modal.style.display = show ? "flex" : "none";
  }

  function difficultyLabel(d) {
    if (d === "easy") return "Facile";
    if (d === "medium") return "Moyen";
    if (d === "hard") return "Difficile";
    return "";
  }

  function updateBadge() {
    if (!difficulty) badgeText.textContent = "Choisis un niveau";
    else badgeText.textContent = `Niveau: ${difficultyLabel(difficulty)}`;
  }

  function render() {
    grid.innerHTML = "";
    for (let i = 0; i < 9; i++) {
      const btn = document.createElement("button");
      btn.className = "cell";
      btn.textContent = board[i];
      btn.disabled = gameOver || board[i] !== "";
      btn.addEventListener("click", () => onClick(i));
      grid.appendChild(btn);
    }
  }

  async function onClick(i) {
    if (!difficulty) { showModal(true); return; }
    if (gameOver || board[i] !== "") return;

    try {
      setStatus(`Niveau: <b>${difficultyLabel(difficulty)}</b> ‚Äî Coup en cours‚Ä¶`);
      const resp = await fetch("/move", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ board, index: i, difficulty })
      });
      const data = await resp.json();
      if (!resp.ok) { setStatus(`Erreur: ${data.error}`); return; }

      board = data.board;
      const w = data.winner;

      if (w === "X") { gameOver = true; setStatus(`‚úÖ Tu as gagn√© ! (Niveau <b>${difficultyLabel(difficulty)}</b>)`); }
      else if (w === "O") { gameOver = true; setStatus(`üòà L‚ÄôIA a gagn√© ! (Niveau <b>${difficultyLabel(difficulty)}</b>)`); }
      else if (w === "DRAW") { gameOver = true; setStatus(`ü§ù Match nul ! (Niveau <b>${difficultyLabel(difficulty)}</b>)`); }
      else { setStatus(`Niveau: <b>${difficultyLabel(difficulty)}</b> ‚Äî √Ä toi : <b>X</b> (IA = O)`); }

      render();
    } catch (e) {
      setStatus("Erreur r√©seau/serveur.");
    }
  }

  function reset(keepLevel=true) {
    board = Array(9).fill("");
    gameOver = false;
    render();
    if (!keepLevel) difficulty = null;
    updateBadge();

    if (difficulty) {
      setStatus(`Niveau: <b>${difficultyLabel(difficulty)}</b> ‚Äî √Ä toi : <b>X</b> (IA = O)`);
    } else {
      setStatus("");
      showModal(true);
    }
  }

  resetBtn.addEventListener("click", () => reset(true));
  changeLevelBtn.addEventListener("click", () => reset(false));

  levelButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      difficulty = btn.dataset.level;
      updateBadge();
      showModal(false);
      reset(true);
    });
  });

  // Start
  updateBadge();
  showModal(true);
  render();
</script>
</body>
</html>
